# Patches Index

–≠—Ç–æ—Ç –∫–∞—Ç–∞–ª–æ–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–∞—Ç—á–∏ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –∏ –µ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å API.

## üìã –°–ø–∏—Å–æ–∫ –ø–∞—Ç—á–µ–π (–ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É)

### P0 - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (—Ç—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è)

1. **001-add-zod-validation.patch.ts**
   - **–ü—Ä–æ–±–ª–µ–º–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ runtime –≤–∞–ª–∏–¥–∞—Ü–∏–∏ WebSocket —Å–æ–æ–±—â–µ–Ω–∏–π
   - **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ Zod schemas –¥–ª—è type-safe –≤–∞–ª–∏–¥–∞—Ü–∏–∏
   - **–§–∞–π–ª—ã:** `frontend/src/types/websocket.ts`, `frontend/src/store/useWebSocketStore.ts`
   - **–í—Ä–µ–º—è:** ~30 –º–∏–Ω—É—Ç

2. **002-fix-type-mismatches.patch.py**
   - **–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–æ–≤ –º–µ–∂–¥—É backend –∏ frontend (qty/size, strategy/mode)
   - **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ field names –≤ backend API –∏–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ adapter layer
   - **–§–∞–π–ª—ã:** `backend/api/routers/trading.py`, `frontend/src/api/adapters/*.ts`
   - **–í—Ä–µ–º—è:** ~45 –º–∏–Ω—É—Ç

3. **007-add-security-headers.patch.ts**
   - **–ü—Ä–æ–±–ª–µ–º–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ CSP –∏ security headers (XSS, CSRF, clickjacking)
   - **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ security headers –≤ nginx, HTML, –∏ FastAPI
   - **–§–∞–π–ª—ã:** `frontend/index.html`, `frontend/nginx.conf`, `backend/api/main.py`
   - **–í—Ä–µ–º—è:** ~20 –º–∏–Ω—É—Ç

### P1 - –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

4. **003-fix-websocket-memory-leak.patch.ts**
   - **–ü—Ä–æ–±–ª–µ–º–∞:** –£—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏ –∏–∑-–∑–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö imports –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π
   - **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ event bus –∏ injection –ø–∞—Ç—Ç–µ—Ä–Ω–∞
   - **–§–∞–π–ª—ã:** `frontend/src/store/useWebSocketStore.ts`, `frontend/src/components/layout/Layout.tsx`
   - **–í—Ä–µ–º—è:** ~1 —á–∞—Å

5. **004-add-error-boundaries.patch.tsx**
   - **–ü—Ä–æ–±–ª–µ–º–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Error Boundaries - –æ—à–∏–±–∫–∏ –ø–∞–¥–∞—é—Ç –¥–æ root
   - **–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω–∏–µ ErrorBoundary –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º
   - **–§–∞–π–ª—ã:** `frontend/src/components/ErrorBoundary.tsx`, `frontend/src/router/routes.tsx`
   - **–í—Ä–µ–º—è:** ~30 –º–∏–Ω—É—Ç

6. **005-fix-websocket-reconnection.patch.ts**
   - **–ü—Ä–æ–±–ª–µ–º–∞:** Reconnection –±–µ–∑ exponential backoff –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å infinite loop
   - **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ exponential backoff —Å jitter –∏ max attempts
   - **–§–∞–π–ª—ã:** `frontend/src/store/useWebSocketStore.ts`
   - **–í—Ä–µ–º—è:** ~45 –º–∏–Ω—É—Ç

7. **006-add-request-cancellation.patch.ts**
   - **–ü—Ä–æ–±–ª–µ–º–∞:** React Query queries –Ω–µ –æ—Ç–º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∏ unmount
   - **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ AbortSignal support –≤ queries
   - **–§–∞–π–ª—ã:** `frontend/src/hooks/useEngine.ts`, `frontend/src/api/endpoints.ts`
   - **–í—Ä–µ–º—è:** ~30 –º–∏–Ω—É—Ç

### P2 - –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

8. **008-optimize-performance.patch.tsx**
   - **–ü—Ä–æ–±–ª–µ–º–∞:** –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ —Ä–µ-—Ä–µ–Ω–¥–µ—Ä—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
   - **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ useMemo, useCallback, React.memo
   - **–§–∞–π–ª—ã:** `frontend/src/pages/Trading.tsx`, `frontend/src/components/ui/Table.tsx`
   - **–í—Ä–µ–º—è:** ~1.5 —á–∞—Å–∞

9. **009-add-ws-type-safety.patch.ts**
   - **–ü—Ä–æ–±–ª–µ–º–∞:** WebSocketMessage.data –∏–º–µ–µ—Ç —Ç–∏–ø `any`
   - **–†–µ—à–µ–Ω–∏–µ:** Discriminated union types –¥–ª—è type-safe message handling
   - **–§–∞–π–ª—ã:** `frontend/src/types/websocket.ts`, `frontend/src/store/useWebSocketStore.ts`
   - **–í—Ä–µ–º—è:** ~1 —á–∞—Å

10. **010-add-offline-support.patch.tsx**
    - **–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ offline —Ä–µ–∂–∏–º–∞
    - **–†–µ—à–µ–Ω–∏–µ:** Offline indicator, Service Worker –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
    - **–§–∞–π–ª—ã:** `frontend/src/hooks/useOnlineStatus.ts`, `frontend/public/service-worker.js`
    - **–í—Ä–µ–º—è:** ~2 —á–∞—Å–∞

## üöÄ –ö–∞–∫ –ø—Ä–∏–º–µ–Ω—è—Ç—å –ø–∞—Ç—á–∏

### –û–±—â–∏–π –ø–æ—Ä—è–¥–æ–∫

1. **–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ –ø–∞—Ç—á** –ø–æ–ª–Ω–æ—Å—Ç—å—é, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
2. **–°–æ–∑–¥–∞–π—Ç–µ backup** –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º
3. **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤ –ø–∞—Ç—á–µ
4. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ** –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ
5. **Commit –∏ push** –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ç—á–∞ 001

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
cd frontend
npm install zod

# 2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–¥ –∏–∑ –ø–∞—Ç—á–∞ 001 –≤:
# frontend/src/types/websocket.ts

# 3. –û–±–Ω–æ–≤–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ–∞–π–ª
# –û–±–Ω–æ–≤–∏—Ç–µ frontend/src/store/useWebSocketStore.ts
# —Å–æ–≥–ª–∞—Å–Ω–æ –ø–∞—Ç—á—É 001

# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ TypeScript
npm run tsc --noEmit

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ dev server
npm run dev

# 6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É
# - –û—Ç–∫—Ä–æ–π—Ç–µ DevTools -> Console
# - –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ WebSocket
# - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è
# - –û—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏)

# 7. Commit
git add .
git commit -m "feat: add Zod validation for WebSocket messages (patch 001)"
```

## üìù Checklist –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ç—á–∞

- [ ] –ü—Ä–æ—á–∏—Ç–∞–Ω –∏ –ø–æ–Ω—è—Ç –ø–∞—Ç—á
- [ ] –°–æ–∑–¥–∞–Ω backup –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- [ ] –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- [ ] TypeScript –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] ESLint –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–æ–∫
- [ ] –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ
- [ ] –ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] Commit —Å–æ–∑–¥–∞–Ω —Å –ø–æ–Ω—è—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –ø–∞—Ç—á–µ–π

### –ü–æ—Å–ª–µ –ø–∞—Ç—á–∞ 001 (Zod Validation)
```typescript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
// –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ –æ—à–∏–±–∫–∏

// –ü—Ä–∏–º–µ—Ä –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è:
// Backend –¥–æ–ª–∂–µ–Ω –æ—Ç–∫–ª–æ–Ω–∏—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ
```

### –ü–æ—Å–ª–µ –ø–∞—Ç—á–∞ 002 (Type Mismatches)
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API response:
curl http://localhost:8000/api/trading/positions | jq '.[0] | keys'
# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–ª—è: size, mode (–∞ –Ω–µ qty, strategy)

# –ò–ª–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
# DevTools -> Network -> Fetch/XHR -> positions
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ response —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–ª—è
```

### –ü–æ—Å–ª–µ –ø–∞—Ç—á–∞ 007 (Security Headers)
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ headers:
curl -I http://localhost:5173
# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å:
# X-Frame-Options: DENY
# X-Content-Type-Options: nosniff
# X-XSS-Protection: 1; mode=block
# Content-Security-Policy: ...

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CSP –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
# DevTools -> Console
# –ü–æ–ø—Ä–æ–±—É–π—Ç–µ: eval('1+1')
# –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞ CSP violation
```

## üîÑ Rollback –ø–∞—Ç—á–µ–π

–ï—Å–ª–∏ –ø–∞—Ç—á –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã:

```bash
# 1. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏–∑ backup
cp frontend/src/store/useWebSocketStore.ts.backup frontend/src/store/useWebSocketStore.ts

# 2. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ git
git checkout HEAD -- frontend/src/store/useWebSocketStore.ts

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ dev server
npm run dev
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Zod Documentation](https://zod.dev/)
- [React Query Cancellation](https://tanstack.com/query/latest/docs/react/guides/query-cancellation)
- [Content Security Policy](https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP)
- [React Error Boundaries](https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary)
- [Service Workers](https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API)

## üí° Tips

- **–ü—Ä–∏–º–µ–Ω—è–π—Ç–µ –ø–∞—Ç—á–∏ –ø–æ –æ–¥–Ω–æ–º—É**, —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º
- **–ù–µ –ø—Ä–æ–ø—É—Å–∫–∞–π—Ç–µ P0 –ø–∞—Ç—á–∏** - –æ–Ω–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
- **–ê–¥–∞–ø—Ç–∏—Ä—É–π—Ç–µ –∫–æ–¥** –ø–æ–¥ –≤–∞—à–∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –Ω—É–∂–¥—ã
- **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** –≤ changelog
- **–û–±–Ω–æ–≤–∏—Ç–µ —Ç–µ—Å—Ç—ã** –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ç—á–µ–π

## üÜò –ü–æ–º–æ—â—å

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –ø–∞—Ç—á–µ–π:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –æ—à–∏–±–æ–∫
4. –°–æ–∑–¥–∞–π—Ç–µ issue —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã

## üìä –ü—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

| –ü–∞—Ç—á | –°—Ç–∞—Ç—É—Å | –î–∞—Ç–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ |
|------|--------|----------------|-------------|
| 001  | ‚è≥ Pending | - | - |
| 002  | ‚è≥ Pending | - | - |
| 003  | ‚è≥ Pending | - | - |
| 004  | ‚è≥ Pending | - | - |
| 005  | ‚è≥ Pending | - | - |
| 006  | ‚è≥ Pending | - | - |
| 007  | ‚è≥ Pending | - | - |
| 008  | ‚è≥ Pending | - | - |
| 009  | ‚è≥ Pending | - | - |
| 010  | ‚è≥ Pending | - | - |

**–õ–µ–≥–µ–Ω–¥–∞:**
- ‚è≥ Pending - –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω
- üîÑ In Progress - –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
- ‚úÖ Applied - –ø—Ä–∏–º–µ–Ω–µ–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- ‚ùå Failed - –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å
- ‚è≠Ô∏è Skipped - –ø—Ä–æ–ø—É—â–µ–Ω

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2 –æ–∫—Ç—è–±—Ä—è 2025  
**–ê–≤—Ç–æ—Ä –ø–∞—Ç—á–µ–π:** Senior Full-Stack Engineer
